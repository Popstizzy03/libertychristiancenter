---
import { getCollection } from "astro:content";
import SanctuaryLayout from "../layouts/SanctuaryLayout.astro";
import Card from "../components/ui/Card.astro";

const events = await getCollection("events");

// Filter for future events (including today)
const today = new Date();
today.setHours(0, 0, 0, 0);

const sortedEvents = events
  .filter((event) => event.data.date >= today)
  .sort((a, b) => a.data.date.valueOf() - b.data.date.valueOf());
---

<SanctuaryLayout title="Events">
  <div class="bg-stone-50 min-h-screen py-12 sm:py-24">
    <div class="max-w-7xl mx-auto px-6 lg:px-8">
      <div class="text-center mb-16">
        <h1
          class="text-4xl font-bold tracking-tight text-stone-900 sm:text-5xl font-serif mb-4"
        >
          Upcoming Events
        </h1>
        <p class="text-lg text-stone-600 max-w-2xl mx-auto">
          Join us for special gatherings, community outreach, and enriching
          fellowship opportunities at Liberty Christian Center.
        </p>
      </div>

      <div
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
      >
        {
          sortedEvents.length === 0 ? (
            <p class="col-span-full text-center text-stone-600 text-lg">No upcoming events at the moment. Please check back later!</p>
          ) : (
            sortedEvents.map((event) => (
              <Card href={`/events/${event.slug}`}>
                {event.data.image && (
                  <div slot="image" class="aspect-video bg-stone-200">
                    <img
                      src={event.data.image}
                      alt={event.data.title}
                      class="w-full h-full object-cover"
                    />
                  </div>
                )}
                {!event.data.image && (
                    <div slot="image" class="aspect-video bg-stone-800 flex items-center justify-center text-stone-500">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5m-9-6h.008v.008H12v-.008zM12 15h.008v.008H12v-.008zM12 18h.008v.008H12v-.008z" />
                        </svg>
                    </div>
                )}

                <div class="flex flex-col h-full">
                  {event.data.category && event.data.category.length > 0 && (
                    <div class="text-xs font-bold text-[#D4AF37] uppercase tracking-wider mb-2">
                        {event.data.category.join(', ')}
                    </div>
                  )}
                  <h3 class="text-xl font-bold text-stone-900 mb-2 line-clamp-2">
                    {event.data.title}
                  </h3>
                  <div class="text-sm text-stone-500 mb-2 flex items-center gap-2">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z" clip-rule="evenodd" />
                      </svg>
                    {event.data.date.toLocaleDateString("en-US", {
                      month: "long",
                      day: "numeric",
                      year: "numeric",
                    })} 
                    {event.data.endDate && (
                        <> - {event.data.endDate.toLocaleDateString("en-US", {
                          month: "long",
                          day: "numeric",
                          year: "numeric",
                        })}</>
                    )}
                    - {event.data.time} {event.data.endTime ? `- ${event.data.endTime}` : ''}
                  </div>
                   <div class="text-sm text-stone-600 mb-4 flex items-center gap-2">
                       <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                          <path fill-rule="evenodd" d="M9.695 2.378c.314-.527.76-.983 1.302-1.314C11.523.75 12.249.5 13 .5c.801 0 1.5.178 2.134.618C15.823 1.583 16.32 2.174 16.636 2.87c.321.71.556 1.492.688 2.296l3.18 1.15c.67.24.962.96.685 1.582l-.462 1.049a.75.75 0 01-.116.143 9.944 9.944 0 010 7.822c.041.164.09.327.148.487.09.24.187.47.293.689.155.313.298.59.431.834.148.27.23.504.23.676 0 .58-.456 1.055-1.077 1.282l-3.18 1.15c-.132.803-.367 1.585-.689 2.297-.317.7-.814 1.291-1.453 1.731C14.501 23.593 13.799 23.75 13 23.75c-.801 0-1.5-.178-2.134-.618-.636-.439-1.134-1.03-1.453-1.73-.321-.711-.556-1.493-.689-2.296l-3.179-1.15c-.671-.24-.962-.96-.685-1.582l.462-1.049c.04-.092.08-.184.116-.275 0-.001 0-.001 0-.002a9.943 9.943 0 010-7.821c-.04-.165-.09-.328-.148-.488-.09-.24-.187-.47-.293-.689-.155-.313-.298-.59-.431-.834-.148-.27-.23-.504-.23-.676 0-.58.456-1.055 1.077-1.282l3.18-1.15c.132-.803.367-1.49.689-2.202Z" />
                        </svg>
                       {event.data.location}
                   </div>
                  <p class="text-sm text-stone-700 line-clamp-3">
                    {event.data.description}
                  </p>
                </div>
              </Card>
            ))
          )
        }
      </div>
    </div>
  </div>
</SanctuaryLayout>
