---
import SanctuaryLayout from '../layouts/SanctuaryLayout.astro';
import { getCollection } from 'astro:content';
import Hero from '../components/blocks/Hero.astro';
import Section from '../components/ui/Section.astro';
import EventRow from '../components/blocks/EventRow.astro';
import ServiceTimes from '../components/blocks/ServiceTimes.astro';
import SermonGrid from '../components/blocks/SermonGrid.astro';
import VisualHighlights from '../components/blocks/VisualHighlights.svelte';

// 1. DATA FETCHING STRATEGY
// We filter and sort data here so the view layer remains clean.

// Get Upcoming Events (Future dates only, sorted ascending)
const now = new Date();
const allEvents = await getCollection('events');
const upcomingEvents = allEvents
  .filter(e => e.data.date >= now) 
  .sort((a, b) => a.data.date.valueOf() - b.data.date.valueOf())
  .slice(0, 3);

// Get Latest Sermon (Sorted descending)
const allSermons = await getCollection('sermons');
const latestSermon = allSermons.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())[0];

// Sample Highlights Data
const highlights = [
  {
    id: '1',
    type: 'image',
    src: 'https://images.unsplash.com/photo-1511632765486-a01980e01a18?q=80&w=2070&auto=format&fit=crop',
    title: 'Community Outreach Day',
    category: 'Service'
  },
  {
    id: '2',
    type: 'image',
    src: 'https://images.unsplash.com/photo-1523580494863-6f3031224c94?q=80&w=2070&auto=format&fit=crop',
    title: 'Sunday Worship Experience',
    category: 'Worship'
  },
  {
    id: '3',
    type: 'image',
    src: 'https://images.unsplash.com/photo-1509021436665-8f07dbf5bf1d?q=80&w=1974&auto=format&fit=crop',
    title: 'Youth Night: Glow Party',
    category: 'Youth'
  },
  {
    id: '4',
    type: 'image',
    src: 'https://images.unsplash.com/photo-1543269865-cbf427effbad?q=80&w=2070&auto=format&fit=crop',
    title: 'Baptism Sunday',
    category: 'Milestone',
    link: '/newsletters/baptism-sunday-2025'
  },
  {
    id: '5',
    type: 'image',
    src: 'https://images.unsplash.com/photo-1529070538774-1843cb3265df?q=80&w=2070&auto=format&fit=crop',
    title: 'New Members Class',
    category: 'Fellowship'
  }
];
---

<SanctuaryLayout title="Home">
  
  <!-- HERO SECTION -->
  <Hero 
    title="✦ Proclaim ✦ Nurture ✦ Release."
    subtitle="Welcome Home"
    backgroundImage="https://images.unsplash.com/photo-1438232992991-995b7058bbb3?q=80&w=2073&auto=format&fit=crop"
    ctaText="Plan Your Visit"
    ctaLink="/visit"
    secondaryCtaText="Watch Online"
    secondaryCtaLink="/sermons"
  >
    Join The Liberty Family with Bishop Dr. Eddie & Rev. Jane Mulenga for our weekly programs.
    <h5>✦ We are located off Kasangula road behind Northgate police post, Lusaka, Zambia</h5>
  </Hero>

  <!-- MISSION STATEMENT -->
  <Section background="white" class="text-center">
    <div class="max-w-3xl mx-auto">
      <h3 class="font-serif text-3xl md:text-4xl text-[#1E293B] mb-6 font-bold">We are Liberty Christian Center</h3>
      <p class="font-sans text-lg text-slate-600 leading-relaxed mb-10">
        Proclaiming The Lord's favour, nurturing and releasing ministries to the nations ✦
        <h3>Luke 4:18</h3>
      </p>
      <div class="h-1 w-20 bg-[#D4A373] mx-auto rounded-full"></div>
    </div>
  </Section>

  <!-- CONTENT GRID: Sermons & Events -->
  <Section background="cream">
    <div class="grid lg:grid-cols-2 gap-16">
      
      <!-- LATEST SERMON BLOCK -->
      <div>
        <div class="flex items-center justify-between mb-8">
          <h3 class="font-serif text-3xl text-[#1E293B] font-bold">Latest Message</h3>
          <a href="/sermons" class="text-sm font-bold text-[#D4A373] hover:text-[#1E293B] uppercase tracking-wide transition-colors">View Archive →</a>
        </div>

        <SermonGrid sermon={latestSermon} />
      </div>

      <!-- UPCOMING EVENTS LIST -->
      <div>
        <div class="flex items-center justify-between mb-8">
          <h3 class="font-serif text-3xl text-[#1E293B] font-bold mt-6">Upcoming Events</h3>
          <a href="/events" class="text-sm font-bold text-[#D4A373] hover:text-[#1E293B] uppercase tracking-wide transition-colors">Full Calendar →</a>
        </div>

        <div class="space-y-6">
          {upcomingEvents.length > 0 ? upcomingEvents.map(event => (
            <EventRow event={event} />
          )) : (
            <div class="p-6 bg-white rounded-sm shadow-sm">
              <p class="text-slate-500 italic">No upcoming events scheduled at this time.</p>
            </div>
          )}
        </div>
        
        <!-- Weekly Schedule Box -->
        <ServiceTimes />

      </div>
    </div>
  </Section>

  <!-- HIGHLIGHTS SECTION -->
  <Section background="white">
    <VisualHighlights client:visible items={highlights} />
  </Section>

</SanctuaryLayout>
