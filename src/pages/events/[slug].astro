---
import { getCollection, render } from 'astro:content';
import SanctuaryLayout from '../../layouts/SanctuaryLayout.astro';

export async function getStaticPaths() {
  const events = await getCollection('events');
  return events.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);
---

<SanctuaryLayout title={entry.data.title}>
  <div class="bg-stone-50 py-12 sm:py-24">
    <div class="max-w-3xl mx-auto px-6 lg:px-8">
      <a href="/events" class="inline-flex items-center gap-2 text-stone-600 hover:text-stone-900 transition-colors mb-8 text-sm font-medium">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
          <path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd" />
        </svg>
        Back to Events
      </a>
      <article class="prose prose-stone prose-lg mx-auto bg-white p-8 rounded-2xl shadow-sm border border-stone-200">
        <header class="mb-8 not-prose">
             {entry.data.category && entry.data.category.length > 0 && (
                <div class="flex gap-2 mb-4">
                    {entry.data.category.map(cat => (
                        <span class="text-xs font-bold text-white bg-[#D4AF37] px-2 py-1 rounded-full uppercase tracking-wide">
                            {cat}
                        </span>
                    ))}
                </div>
            )}
            <h1 class="text-3xl font-bold tracking-tight text-stone-900 sm:text-4xl mb-4">
                {entry.data.title}
            </h1>
            
            <div class="flex flex-col gap-3 text-stone-600 text-sm border-b border-stone-200 pb-6">
                <div class="flex items-center gap-2">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-[#D4AF37]">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-13a.75.75 0 00-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 000-1.5h-3.25V5z" clip-rule="evenodd" />
                    </svg>
                    <span class="font-medium">
                        {entry.data.date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}
                        {entry.data.endDate && (
                            <> &ndash; {entry.data.endDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}</>
                        )}
                    </span>
                    <span class="text-stone-400">|</span>
                    <span>{entry.data.time} {entry.data.endTime ? `- ${entry.data.endTime}` : ''}</span>
                </div>
                <div class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-[#D4AF37]">
                         <path fill-rule="evenodd" d="M9.695 2.378c.314-.527.76-.983 1.302-1.314C11.523.75 12.249.5 13 .5c.801 0 1.5.178 2.134.618C15.823 1.583 16.32 2.174 16.636 2.87c.321.71.556 1.492.688 2.296l3.18 1.15c.67.24.962.96.685 1.582l-.462 1.049a.75.75 0 01-.116.143 9.944 9.944 0 010 7.822c.041.164.09.327.148.487.09.24.187.47.293.689.155.313.298.59.431.834.148.27.23.504.23.676 0 .58-.456 1.055-1.077 1.282l-3.18 1.15c-.132.803-.367 1.585-.689 2.297-.317.7-.814 1.291-1.453 1.731C14.501 23.593 13.799 23.75 13 23.75c-.801 0-1.5-.178-2.134-.618-.636-.439-1.134-1.03-1.453-1.73-.321-.711-.556-1.493-.689-2.296l-3.179-1.15c-.671-.24-.962-.96-.685-1.582l.462-1.049c.04-.092.08-.184.116-.275 0-.001 0-.001 0-.002a9.943 9.943 0 010-7.821c-.04-.165-.09-.328-.148-.488-.09-.24-.187-.47-.293-.689-.155-.313-.298-.59-.431-.834-.148-.27-.23-.504-.23-.676 0-.58.456-1.055 1.077-1.282l3.18-1.15c.132-.803.367-1.49.689-2.202Z" />
                    </svg>
                    {entry.data.location}
                </div>
                {entry.data.organizer && (
                     <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-[#D4AF37]">
                            <path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.23 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.408-1.41a7.002 7.002 0 00-13.074.003z" />
                        </svg>
                        Organized by {entry.data.organizer}
                    </div>
                )}
                {entry.data.payment && (
                    <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-[#D4AF37]">
                            <path fill-rule="evenodd" d="M2.5 4A1.5 1.5 0 001 5.5V6h18v-.5A1.5 1.5 0 0017.5 4h-15zM19 8.5H1v6A1.5 1.5 0 002.5 16h15a1.5 1.5 0 001.5-1.5v-6zM3 13.25a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5h-1.5a.75.75 0 01-.75-.75zm4.75-.75a.75.75 0 000 1.5h1.5a.75.75 0 000-1.5h-1.5z" clip-rule="evenodd" />
                        </svg>
                        Cost: {entry.data.payment}
                    </div>
                )}
            </div>
        </header>

        {entry.data.image && (
          <div class="aspect-video mb-8 rounded-xl overflow-hidden bg-stone-200">
            <img
              class="w-full h-full object-cover"
              src={entry.data.image}
              alt={entry.data.title}
            />
          </div>
        )}

        <div class="text-lg text-stone-700 mb-8 italic">
            {entry.data.description}
        </div>

        <Content />

        {entry.data.registration_link && (
            <div class="mt-8 not-prose">
                <a 
                    href={entry.data.registration_link} 
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-stone-900 bg-[#D4AF37] hover:bg-[#C4A030] transition-colors"
                >
                    Register / Learn More
                </a>
            </div>
        )}
      </article>
    </div>
  </div>
</SanctuaryLayout>
